<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PMS | Public Request Tester</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; color: #111; }
		.container { max-width: 820px; margin: 0 auto; }
		label { display: block; margin: 12px 0 6px; font-weight: 600; }
		input, textarea { width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
		textarea { min-height: 120px; }
		button { margin-top: 16px; padding: 10px 16px; border: 0; border-radius: 8px; background: #1f6feb; color: #fff; font-weight: 600; cursor: pointer; }
		button:disabled { opacity: .6; cursor: default; }
		pre { background: #0f172a; color: #e5e7eb; padding: 12px; border-radius: 8px; overflow: auto; }
		.small { color: #555; font-size: 13px; }
		.row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
	</style>
</head>
<body>
	<div class="container">
		<h1>Public Request Tester</h1>
		<p class="small">Backend assumed running at <code>http://localhost:3000</code>. This page sends a POST to <code>/public/requests</code>.</p>

		<form id="requestForm">
			<label for="title">Title</label>
			<input id="title" name="title" placeholder="New feature" required>

			<label for="description">Description</label>
			<textarea id="description" name="description" placeholder="Describe your request" required></textarea>

			<div class="row">
				<div>
					<label for="email">Requester Email</label>
					<input id="email" name="email" type="email" placeholder="user@example.com" required>
				</div>
				<div>
					<label for="name">Requester Name (optional)</label>
					<input id="name" name="name" placeholder="Jane Doe">
				</div>
			</div>

			<label for="sla">Target SLA Hours (optional)</label>
			<input id="sla" name="sla" type="number" min="1" max="2160" placeholder="72">

			<label for="details">Details JSON (optional)</label>
			<textarea id="details" name="details" placeholder='{"Project":"...","Priority":"..."}'></textarea>

			<button id="submitBtn" type="submit">Create Request</button>
		</form>

		<h3>Result</h3>
		<pre id="result">(Awaiting submission...)</pre>

		<h3>Equivalent cURL</h3>
		<pre id="curl"></pre>

		<h3>Postman Instructions</h3>
		<ol>
			<li>Open Postman and create a new request.</li>
			<li>Method: <strong>POST</strong>, URL: <code>http://localhost:3000/public/requests</code>.</li>
			<li>Headers: <code>Content-Type: application/json</code>.</li>
			<li>Body (raw, JSON):</li>
		</ol>
		<pre>{
  "title": "New feature",
  "description": "Add export to CSV",
  "requesterEmail": "user@example.com",
  "requesterName": "Jane",
  "targetSlaHours": 72
}</pre>
	</div>

	<script>
		const form = document.getElementById('requestForm');
		const result = document.getElementById('result');
		const curl = document.getElementById('curl');
		const submitBtn = document.getElementById('submitBtn');

		function buildPayload() {
			const title = document.getElementById('title').value.trim();
			const description = document.getElementById('description').value.trim();
			const requesterEmail = document.getElementById('email').value.trim();
			const requesterName = document.getElementById('name').value.trim();
			const targetSlaHours = document.getElementById('sla').value.trim();

			const payload = { title, description, requesterEmail };
			if (requesterName) payload.requesterName = requesterName;
			if (targetSlaHours) payload.targetSlaHours = Number(targetSlaHours);
			const detailsRaw = document.getElementById('details').value.trim();
			if (detailsRaw) {
				try { payload.details = JSON.parse(detailsRaw); } catch(e) { alert('Details must be valid JSON'); throw e; }
			}
			return payload;
		}

		function updateCurl(payload) {
			const json = JSON.stringify(payload).replaceAll('"', '\\"');
			curl.textContent = `curl -X POST http://localhost:3000/public/requests ^\n  -H "Content-Type: application/json" ^\n  -d "\"${json}\""`;
		}

		form.addEventListener('input', () => updateCurl(buildPayload()));
		updateCurl(buildPayload());

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const payload = buildPayload();
			updateCurl(payload);
			result.textContent = 'Submitting...';
			submitBtn.disabled = true;
			try {
				const res = await fetch('http://localhost:3000/public/requests', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(payload)
				});
				const text = await res.text();
				let formatted = text;
				try { formatted = JSON.stringify(JSON.parse(text), null, 2); } catch {}
				result.textContent = `Status: ${res.status}\n${formatted}`;
			} catch (err) {
				result.textContent = 'Error: ' + (err && err.message ? err.message : String(err));
			} finally {
				submitBtn.disabled = false;
			}
		});
	</script>
</body>
</html>
